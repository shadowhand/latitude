<?php
declare(strict_types=1);

namespace Latitude\QueryBuilder;

use Countable;
use Iterator;

/**
 * Class ValueList
 * @package Latitude\QueryBuilder
 */
class ValueList implements
    Countable,
    Statement
{
    use Traits\CanConvertIteratorToString;
    use Traits\CanReplaceBooleanAndNullValues;

    /**
     * Create a new value list.
     * @psalm-suppress TooManyArguments
     */
    public static function make(array $params): ValueList
    {
        $values = new static();
        $values->params = array_values($params);
        return $values;
    }

    // Countable
    /**
     * @return int
     */
    public function count()
    {
        return \count($this->params);
    }

    // Statement
    public function sql(Identifier $identifier = null): string
    {
        return '(' . $this->stringifyIterator($this->generatePlaceholders()) . ')';
    }

    // Statement
    public function params(): array
    {
        return $this->placeholderParams();
    }

    /**
     * @var array
     */
    protected $params = [];

    /**
     * Generate a placeholder.
     */
    protected function generatePlaceholders(): Iterator
    {
        foreach (\array_keys($this->params) as $index) {
            yield $this->placeholderValue($index);
        }
    }
}
